<!DOCTYPE html>
<html>
<head>
    <title>Змейка</title>
    <meta charset="utf-8">
    <style>
        body {
            margin: 0;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
        }

        canvas {
            background-color: #eee;
            border: 4px solid #000;
            z-index: 1;
        }

        #scoreboard {
            color: #fff;
            font-size: 18px;
            margin-bottom: 10px;
        }

        #controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        .controls-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .control-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 60px;
        }

        .control-button.round {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-button:hover {
            background-color: #3e8e41;
        }

        .left-btn {
            height: 130px;
        }

        .up-btn, .down-btn {
            height: 60px;
        }

        .right-btn {
            height: 130px;
        }

        #gameOverMenu {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background-color: #eee;
            border: 4px solid #000;
            padding: 20px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }

        #gameOverMenu input, #gameOverMenu button {
            padding: 8px;
            font-size: 16px;
            width: 200px;
        }

        #saveBtn {
            padding: 8px 16px; /* Прямоугольная кнопка */
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        #saveBtn:hover {
            background-color: #3e8e41;
        }

        #championsTableContainer {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #eee;
            border: 4px solid #000;
            padding: 20px;
            z-index: 3;
        }

        #championsTable {
            width: 100%;
            border-collapse: collapse;
        }

        #championsTable th, #championsTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        #championsTable th {
            background-color: #f2f2f2;
            color: #333;
        }
    </style>
</head>
<body>
<div id="scoreboard">Счёт: 0</div>
<div style="position: relative;">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div id="gameOverMenu">
        <p>Игра окончена!</p>
        <input type="text" id="playerName" placeholder="Ваше имя">
        <button id="saveBtn">Сохранить</button>
    </div>
</div>
<div id="controls">
    <div id="left-controls">
        <button id="restartBtn" class="control-button round">Рестарт</button>
        <button id="championsBtn" class="control-button round">Чемпионы</button>
    </div>
    <button id="leftBtn" class="control-button left-btn">Влево</button>
    <div class="controls-column">
        <button id="upBtn" class="control-button up-btn">Вверх</button>
        <button id="downBtn" class="control-button down-btn">Вниз</button>
    </div>
    <button id="rightBtn" class="control-button right-btn">Вправо</button>
</div>

<div id="championsTableContainer">
    <table id="championsTable">
        <thead>
        <tr>
            <th>Имя</th>
            <th>Результат</th>
            <th>Дата</th>
        </tr>
        </thead>
        <tbody id="championsBody">
        <!-- Здесь будут строки таблицы с данными о чемпионах -->
        </tbody>
    </table>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreboard = document.getElementById('scoreboard');
    const upBtn = document.getElementById('upBtn');
    const downBtn = document.getElementById('downBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');
    const restartBtn = document.getElementById('restartBtn');
    const gameOverMenu = document.getElementById('gameOverMenu');
    const saveBtn = document.getElementById('saveBtn');
    const championsBtn = document.getElementById('championsBtn');
    const championsTableContainer = document.getElementById('championsTableContainer');
    const championsTableBody = document.getElementById('championsBody');

    const gridSize = 20;
    let snake = [{ x: 10, y: 10 }];
    let food = {};
    let direction = 'right';
    let score = 0;
    let gameOver = false;
    let intervalId;

    function generateFood() {
        food = {
            x: Math.floor(Math.random() * (canvas.width / gridSize)),
            y: Math.floor(Math.random() * (canvas.height / gridSize))
        };
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < snake.length; i++) {
            ctx.fillStyle = i === 0 ? 'green' : 'lime';
            ctx.fillRect(snake[i].x * gridSize, snake[i].y * gridSize, gridSize, gridSize);
        }

        ctx.fillStyle = 'red';
        ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize, gridSize);
    }

    function update() {
        if (gameOver) return;

        const head = { x: snake[0].x, y: snake[0].y };

        switch (direction) {
            case 'up': head.y--; break;
            case 'down': head.y++; break;
            case 'left': head.x--; break;
            case 'right': head.x++; break;
        }

        if (head.x < 0 || head.x >= canvas.width / gridSize || head.y < 0 || head.y >= canvas.height / gridSize || checkCollision(head)) {
            gameOver = true;
            clearInterval(intervalId);
            showGameOverMenu();
            return;
        }

        snake.unshift(head);

        if (head.x === food.x && head.y === food.y) {
            score++;
            scoreboard.textContent = 'Счёт: ' + score;
            generateFood();
        } else {
            snake.pop();
        }

        draw();
    }

    function checkCollision(head) {
        for (let i = 1; i < snake.length; i++) {
            if (head.x === snake[i].x && head.y === snake[i].y) {
                return true;
            }
        }
        return false;
    }

    function restartGame() {
        snake = [{ x: 10, y: 10 }];
        generateFood();
        direction = 'right';
        score = 0;
        gameOver = false;
        scoreboard.textContent = 'Счёт: 0';
        gameOverMenu.style.display = 'none';
        intervalId = setInterval(update, 200); // Увеличили интервал обновления для замедления змейки
    }

    async function saveScore() {
        const playerName = document.getElementById('playerName').value;
        const result = {
            name: playerName,
            score: score
        };
        try {
            const response = await fetch('http://localhost:7070/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(result)
            });
            if (response.ok) {
                alert('Результат сохранен');
            } else {
                alert('Ошибка при сохранении результата');
            }
        } catch (error) {
            alert('Ошибка: ' + error.message);
        }
    }

    async function fetchChampions() {
        try {
            const response = await fetch('http://localhost:7070/save');
            if (response.ok) {
                const data = await response.json();
                displayChampions(data);
                championsTable.style.display = 'block'; // Показать таблицу лидеров
            } else {
                throw new Error('Ошибка при получении данных');
            }
        } catch (error) {
            alert('Ошибка: ' + error.message);
        }
    }

    async function fetchChampions() {
        try {
            const response = await fetch('http://localhost:7070/save');
            if (response.ok) {
                const data = await response.json();
                displayChampions(data);
            } else {
                throw new Error('Ошибка при получении данных');
            }
        } catch (error) {
            alert('Ошибка: ' + error.message);
        }
    }

    function displayChampions(champions) {
        championsTableBody.innerHTML = ''; // Очистим текущие данные в таблице
        champions.forEach(champion => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${champion.name}</td>
                <td>${champion.result}</td>
                <td>${champion.time}</td>
            `;
            championsTableBody.appendChild(row);
        });
        championsTableContainer.style.display = 'block'; // Показываем таблицу с чемпионами
    }

    function showGameOverMenu() {
        gameOverMenu.style.display = 'flex';
    }

    // Обработчики событий для кнопок управления змейкой
    leftBtn.addEventListener('click', () => {
        if (direction !== 'right') {
            direction = 'left';
        }
    });

    upBtn.addEventListener('click', () => {
        if (direction !== 'down') {
            direction = 'up';
        }
    });

    downBtn.addEventListener('click', () => {
        if (direction !== 'up') {
            direction = 'down';
        }
    });

    rightBtn.addEventListener('click', () => {
        if (direction !== 'left') {
            direction = 'right';
        }
    });

    restartBtn.addEventListener('click', restartGame);
    saveBtn.addEventListener('click', saveScore);
    championsBtn.addEventListener('click', fetchChampions);

    generateFood();
    intervalId = setInterval(update, 700); // Увеличили интервал обновления для замедления змейки
</script>
</body>
</html>
